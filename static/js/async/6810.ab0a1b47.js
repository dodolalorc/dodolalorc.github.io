"use strict";(self.webpackChunkblogsite_rspress=self.webpackChunkblogsite_rspress||[]).push([["6810"],{4292:function(e,n,r){r.r(n),r.d(n,{default:()=>h});var s=r(2676),i=r(453),d=r(5523);function l(e){let n=Object.assign({p:"p",blockquote:"blockquote",h2:"h2",a:"a",ul:"ul",li:"li",code:"code",img:"img",pre:"pre"},(0,i.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"+++\r\ntitle = '为twikoo添加图片功能'\r\ndate = 2024-05-29T15:24:24+08:00\r\ndraft = false\r\ntags = [\r\n'Twikoo'\r\n]\r\ncategories = [\r\n'关于Hugo的一些设置'\r\n]\r\n+++"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"一篇私有配置图床，给 twikoo 评论插件添加图片功能的文章。"}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"背景",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#背景",children:"#"}),"背景"]}),"\n",(0,s.jsx)(d.Z,{defaultLocale:"zh-CN"}),"\n",(0,s.jsx)(n.p,{children:"背景：最近回想起来本站的 twikoo 评论尚未配置过图床，所以此前评论区不能上传图片，这篇就记录一下 twikoo 官方推荐的 lsky-pro 私有部署图床。"}),"\n",(0,s.jsxs)(n.p,{children:["选用的图床是兰空图床 \uD83D\uDC49",(0,s.jsx)(n.a,{href:"https://github.com/lsky-org/lsky-pro",rel:"noopener noreferrer",target:"_blank",children:"lsky-org/lsky-pro: ☁️ 兰空图床(Lsky Pro) - Your photo album on the cloud. (github.com)"})]}),"\n",(0,s.jsxs)(n.p,{children:["文档：",(0,s.jsx)(n.a,{href:"https://docs.lsky.pro/",rel:"noopener noreferrer",target:"_blank",children:"Lsky Pro"})]}),"\n",(0,s.jsx)(n.p,{children:"服务器环境："}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"宝塔面板 8.0.6"}),"\n",(0,s.jsx)(n.li,{children:"PHP 8.0.26"}),"\n",(0,s.jsx)(n.li,{children:"MySQL 5.7.43"}),"\n",(0,s.jsx)(n.li,{children:"Nginx 1.22.1"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"要注意版本哦("}),"\n",(0,s.jsxs)(n.h2,{id:"添加站点",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#添加站点",children:"#"}),"添加站点"]}),"\n",(0,s.jsxs)(n.p,{children:["进入宝塔后，在左侧",(0,s.jsx)(n.code,{children:"网站"}),"导航页内点击",(0,s.jsx)(n.code,{children:"添加站点"}),"，新建一个网站，配置如图："]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://cdn.jsdelivr.net/gh/dodolalorc/dodolaPicBed/image-20240529160531123.png",alt:"添加站点"})}),"\n",(0,s.jsxs)(n.h2,{id:"配置站点",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置站点",children:"#"}),"配置站点"]}),"\n",(0,s.jsxs)(n.p,{children:["在",(0,s.jsx)(n.a,{href:"https://github.com/lsky-org/lsky-pro/releases",rel:"noopener noreferrer",target:"_blank",children:"Releases \xb7 lsky-org/lsky-pro (github.com)"}),"选择",(0,s.jsx)(n.code,{children:"Assets"}),"中的第一个",(0,s.jsx)(n.code,{children:".zip"}),"下载下来。定位到上述创建的站点的根目录(",(0,s.jsx)(n.code,{children:"/www/wwwroot/img.dodolalorc.cn"}),")下，将解压后的文件放在该目录下。"]}),"\n",(0,s.jsxs)(n.p,{children:["将程序所在目录的所有文件夹、子文件夹、文件的权限，用户组和所有者改为 ",(0,s.jsx)(n.code,{children:"www"}),"，权限改为 ",(0,s.jsx)(n.code,{children:"0755"})]}),"\n",(0,s.jsx)(n.p,{children:"回到网站导航页，点击刚刚创建的站点，进行如下修改："}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["网站目录下，将网站目录中的路径后添加",(0,s.jsx)(n.code,{children:"/public"}),"，并保存"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Nginx 需要设置伪静态，点击伪静态，添加如下代码并保存："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"location / {\r\n  try_files $uri $uri/ /index.php?$query_string;\r\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["在 SSL 中，申请",(0,s.jsx)(n.code,{children:"Let's Encrypt"}),"证书，申请成功并安装保存之后，在证书页开启强制",(0,s.jsx)(n.code,{children:"HTTPS"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"php-扩展禁用函数",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#php-扩展禁用函数",children:"#"}),"PHP 扩展+禁用函数"]}),"\n",(0,s.jsxs)(n.p,{children:["根据文档所提示的安装要求，我们需要添加两个扩展：",(0,s.jsx)(n.code,{children:"Fileinfo PHP 扩展"}),"和",(0,s.jsx)(n.code,{children:"Imagick 拓展"}),"。"]}),"\n",(0,s.jsx)(n.p,{children:"在宝塔软件商店内搜索使用的 PHP，点击管理，在安装扩展中选择下载 fileinfo 和 imagemagick 扩展。"}),"\n",(0,s.jsx)(n.p,{children:"在禁用函数页面，删除 exec、shell_exec、readlink、symlink、putenv、getenv、chmod、chown、fileperms 函数。"}),"\n",(0,s.jsxs)(n.p,{children:["若由于可用内存小于 1G，没有安装上 fileinfo，可以在软件商店搜索找到 Linux 工具箱，在工具箱中的",(0,s.jsx)(n.code,{children:"Swap/虚拟内存"}),"中添加 Swap，设置为 1024MB 并确定，重试即可。"]}),"\n",(0,s.jsxs)(n.h2,{id:"安装程序",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#安装程序",children:"#"}),"安装程序"]}),"\n",(0,s.jsx)(n.p,{children:"在完成上述内容后，访问站点，显示符合要求之后，点击下一步，填写配置后进行安装。"}),"\n",(0,s.jsxs)(n.h2,{id:"获取-token",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#获取-token",children:"#"}),"获取 token"]}),"\n",(0,s.jsx)(n.p,{children:"在站点的仪表盘页，点击接口，复制接口 URL。"}),"\n",(0,s.jsxs)(n.p,{children:["在这个网站",(0,s.jsx)(n.a,{href:"https://getman.cn/",rel:"noopener noreferrer",target:"_blank",children:"Getman.cn"}),"，按照这个格式填写："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "email": "管理员邮箱",\r\n  "password": "管理员密码"\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://cdn.jsdelivr.net/gh/dodolalorc/dodolaPicBed/1717328841131.png",alt:"1717328841131"})}),"\n",(0,s.jsxs)(n.h2,{id:"配置-twikoo",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置-twikoo",children:"#"}),"配置 Twikoo"]}),"\n",(0,s.jsxs)(n.p,{children:["获取到 token 后，在 twikoo 管理页，",(0,s.jsx)(n.code,{children:"IMAGE_CDN"})," 配置图床首页 URL 地址（注意不要加尾随斜杠），",(0,s.jsx)(n.code,{children:"IMAGE_CDN_TOKEN"}),"填入刚刚获取的 token。"]}),"\n",(0,s.jsx)(n.p,{children:"保存后，即可上传图片。"})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(l,e)})):l(e)}let h=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["posts%2Fstartsite%2Ftwikoo_with_imgs.md"]={toc:[{id:"背景",text:"背景",depth:2},{id:"添加站点",text:"添加站点",depth:2},{id:"配置站点",text:"配置站点",depth:2},{id:"php-扩展禁用函数",text:"PHP 扩展+禁用函数",depth:2},{id:"安装程序",text:"安装程序",depth:2},{id:"获取-token",text:"获取 token",depth:2},{id:"配置-twikoo",text:"配置 Twikoo",depth:2}],title:"",headingTitle:"",frontmatter:{}}},5523:function(e,n,r){r.d(n,{Z:()=>h});var s=r(2676),i=r(5271),d=r(2815);r(7995);let l={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"小于 1 分钟"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function c(e,n,r){let s=Object.keys(l).includes(n)?n:r;return l[s](e)}let h=e=>{let{defaultLocale:n="en-US"}=e,r=(0,d.Vi)().page.readingTimeData,l=(0,d.Jr)(),h=(0,d.e7)(),[t,o]=(0,i.useState)(c(r,l,n));return(0,i.useEffect)(()=>{o(c(r,l,n))},[l,r]),(0,s.jsx)("span",{"data-dark":String(h),className:"rp-reading-time",children:t})}}}]);